<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Engineering MCQ Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(135deg, #fceabb, #f8b500, #1e3c72, #2a5298);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: #222;
    overflow-x: hidden;
    position: relative;
  }
  @keyframes gradientBG {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }
  .symbol {
    position: absolute;
    font-size: 3rem;
    color: rgba(255,255,255,0.15);
    animation: float 20s linear infinite;
    z-index: 0;
  }
  @keyframes float {
    0% {transform: translateY(0) rotate(0deg);}
    50% {transform: translateY(-20px) rotate(180deg);}
    100% {transform: translateY(0) rotate(360deg);}
  }
  header {
    text-align:center;
    padding:2rem 1rem;
    background: rgba(255,255,255,0.4);
    border-bottom: 2px solid rgba(0,0,0,0.05);
    backdrop-filter: blur(5px);
    border-radius: 1rem;
    overflow: hidden;
    position: relative;
    z-index: 1;
  }
  header h1 {
    font-size: 2.8rem;
    font-weight: 700;
    color: #222;
  }
  .container {max-width:1100px; margin:auto; padding:1rem; position: relative; z-index: 1;}
  .sections {display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:1.5rem; margin-top:2rem;}
  .section-card, .nav-btn, .view-mark-btn {
    background: rgba(255,255,255,0.85);
    border-radius:1rem; padding:1.5rem; text-align:center; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    cursor:pointer; transition: all 0.2s ease-in-out; color:#222; font-weight:500;
  }
  .section-card:hover, .nav-btn:hover, .view-mark-btn:hover {background: rgba(255,255,255,1); transform: translateY(-3px);}
  .nav-btn.small-btn {padding:0.4rem 0.8rem; font-size:0.85rem; margin-bottom:0.8rem;}
  .nav-btn.page-btn {padding:0.4rem 0.8rem; font-size:0.85rem; margin: 0 0.3rem;}
  .question-container {margin-top: 2rem; text-align: left;}
  .question {
    background: rgba(245,248,255,0.97);
    padding:1.2rem; border-radius:1rem; margin-bottom:1.5rem; box-shadow:0 4px 15px rgba(0,0,0,0.1); position:relative;
  }

  /* ---- KEY FIXES BELOW ----
     Ensures options align exactly under the start of the question text
  */
  .question h3 {
    margin: 0 0 0.35rem 0;       /* smaller bottom gap, consistent start */
    color: #2a5298;
    padding: 0;                  /* no extra padding */
  }

  /* Remove default UL indentation and ensure options start under question */
  .options {
    list-style: none;
    margin: 0;                   /* remove top/bottom margins */
    padding: 0;                  /* remove default left padding */
    margin-top: 0.25rem;         /* small vertical separation from question */
  }

  /* li alignment: no left margin so it lines up with question start */
  .options li {
    background: rgba(255,255,255,0.6);
    padding:0.6rem 1rem;
    margin: 0 0 0.5rem 0;        /* only bottom margin */
    border-radius:0.5rem;
    cursor:pointer;
    transition: background 0.15s ease;
    display: block;              /* ensures full-width clickable area */
    box-sizing: border-box;
  }
  .options li:hover {background: rgba(255,255,255,0.85);}
  .star, .report {position:absolute; top:1rem; font-size:1.5rem; cursor:pointer; color:#444; user-select:none;}
  .star {right:3rem;} .report {right:1rem;}
  .star.marked {color: gold;} .report.reported {color: crimson;}
  #pagination {display: flex; justify-content: center; align-items: center; margin-top:1.5rem; color:#fff; font-weight:bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.7);}
  #pagination .page-info {margin: 0 0.5rem;}
  .group-count {font-size:0.85rem; color:#2a5298; margin-top:0.5rem;}
  img {border-radius:0.5rem; margin-top:0.5rem; border: 2px solid rgba(0,0,0,0.05);}
  #wrongCount {text-align:center; margin-top:1rem; font-weight:bold; color:#b71c1c; font-size:1.2rem; display:none;}
</style>
</head>
<body>
  <!-- Background Symbols -->
  <div class="symbol" style="top:10%; left:5%;">‚àë</div>
  <div class="symbol" style="top:40%; left:20%;">œÄ</div>
  <div class="symbol" style="top:70%; left:15%;">‚àö</div>
  <div class="symbol" style="top:20%; right:10%;">Œî</div>
  <div class="symbol" style="top:50%; right:5%;">‚àû</div>
  <div class="symbol" style="top:80%; right:25%;">‚âà</div>
  <div class="symbol" style="top:15%; right:40%;">‚à´</div>
  <div class="symbol" style="top:60%; left:45%;">Œ∏</div>
  <div class="symbol" style="top:35%; left:70%;">Œª</div>
  <div class="symbol" style="top:85%; left:30%;">Œ©</div>

  <div class="container">
    <header><h1>‚ö° Engineering MCQ Portal</h1></header>
    <div id="main-view">
      <div class="sections" id="sections-list"></div>
      <div style="text-align:center; margin-top:1rem;">
        <button class="view-mark-btn nav-btn" id="viewMarkedBtn">‚≠ê View Marked Questions</button>
        <button class="view-mark-btn nav-btn" id="viewReportedBtn">üö© View Reported Questions</button>
      </div>
    </div>
    <!-- Subsection / grouping view -->
    <div id="subsection-view" style="display:none; text-align:left;">
      <button class="nav-btn small-btn" id="backFromSubsectionBtn">‚Üê Back</button>
      <h2 id="subsection-title" style="margin-top:0.5rem; text-align:center;">Select Subsection</h2>
      <div class="sections" id="subsections-list"></div>
    </div>
    <!-- Question view -->
    <div id="question-view" style="display:none; text-align:left;">
      <div style="display:flex; align-items:center; margin-bottom:1rem;">
        <button class="nav-btn small-btn" id="backBtn">‚Üê Back</button>
      </div>

      <div id="wrongCount">Wrong Answers: 0</div>
      <div class="question-container" id="questionsContainer"></div>
      <div id="pagination">
        <button class="nav-btn page-btn" id="prevBtn">‚Üê Previous</button>
        <span class="page-info" id="pageInfo">Page 1 of 1</span>
        <button class="nav-btn page-btn" id="nextBtn">Next ‚Üí</button>
      </div>
    </div>
  </div>

  <!-- keep your external questions.js -->
  <script src="questions.js"></script>

  <script>
    // Sections and app state (unchanged)
    const sections = [
      "Structural Engineering","Engineering Survey","Construction Materials","Concrete Technology",
      "Geotechnical Engineering","Construction Management","Estimation and Costing","Engineering Drawing",
      "Engineering Economics","Professional Practice","Apex Questions","General Knowledge","Practice GK","500+ MCQ","Practice Questions","IQ"
    ];

    const practicePattern = {
      "Structural Engineering":5,"Engineering Survey":7,"Construction Materials":6,"Concrete Technology":5,
      "Geotechnical Engineering":6,"Construction Management":6,"Estimation and Costing":5,"Engineering Drawing":4,
      "Engineering Economics":3,"Professional Practice":3
    };

    let currentSection = null;
    let currentSubsection = null;
    let currentPage = 0;
    let customFlow = false;
    let marked = JSON.parse(localStorage.getItem('marked') || '[]');
    let reported = JSON.parse(localStorage.getItem('reported') || '[]');
    const pageSize = 25;
    let currentQuestions = [];
    let wrongCount = 0;

    const secList = document.getElementById('sections-list');
    sections.forEach(sec => {
      const card = document.createElement('div');
      card.className = 'section-card';
      card.textContent = sec;
      card.addEventListener('click', () => handleSectionClick(sec));
      secList.appendChild(card);
    });

    document.getElementById('backBtn').addEventListener('click', goBack);
    document.getElementById('backFromSubsectionBtn').addEventListener('click', () => {
      if (customFlow) { toggleView('main-view'); customFlow = false; } else { toggleView('main-view'); }
    });
    document.getElementById('viewMarkedBtn').addEventListener('click', prepareMarkedView);
    document.getElementById('viewReportedBtn').addEventListener('click', prepareReportedView);

    function toggleView(id) {
      ['main-view','subsection-view','question-view'].forEach(v => {
        document.getElementById(v).style.display = (v === id) ? 'block' : 'none';
      });
    }

    function handleSectionClick(sec) {
      customFlow = false;
      currentSection = sec;
      currentSubsection = null;

      if (sec === 'Practice Questions') { loadPracticeQuestions(); return; }
      if (sec === 'Practice GK') { loadPracticeGKQuestions(); return; }

      const data = window.mcqData && window.mcqData[sec];
      if (data && typeof data === 'object' && !Array.isArray(data)) loadSubsections(sec);
      else loadSectionQuestions(sec);
    }

    function loadSubsections(sec) {
      currentSection = sec;
      const subs = Object.keys(window.mcqData[sec] || {});
      document.getElementById('subsection-title').textContent = sec;
      const list = document.getElementById('subsections-list'); list.innerHTML = '';
      subs.forEach(sub => {
        const card = document.createElement('div');
        card.className = 'section-card';
        card.textContent = sub;
        card.addEventListener('click', () => loadSubsectionQuestions(sec, sub));
        list.appendChild(card);
      });
      toggleView('subsection-view');
    }

    function loadSubsectionQuestions(sec, sub) {
      customFlow = false;
      currentSection = sec;
      currentSubsection = sub;
      currentQuestions = (window.mcqData[sec][sub] || []).map((q,i) => ({ ...q, section: sec, subsection: sub, origIdx: i, _wrongCounted: false }));
      currentPage = 0;
      document.getElementById('wrongCount').style.display = "none";
      renderQuestions();
      toggleView('question-view');
    }

    function loadSectionQuestions(sec) {
      customFlow = false;
      currentSection = sec;
      currentSubsection = null;
      currentQuestions = (window.mcqData[sec] || []).map((q,i) => ({ ...q, section: sec, subsection: null, origIdx: i, _wrongCounted: false }));
      currentPage = 0;
      document.getElementById('wrongCount').style.display = "none";
      renderQuestions();
      toggleView('question-view');
    }

    function loadPracticeQuestions() {
      customFlow = false;
      currentSection = 'Practice Questions';
      currentSubsection = null;
      currentQuestions = [];
      wrongCount = 0;
      document.getElementById('wrongCount').textContent = "Wrong Answers: 0";
      document.getElementById('wrongCount').style.display = "block";
      let poolIndex = 0;
      Object.entries(practicePattern).forEach(([sec,count]) => {
        let arr = window.mcqData[sec];
        if (arr && typeof arr === 'object' && !Array.isArray(arr)) arr = Object.values(arr).flat();
        const picks = (arr || []).sort(() => Math.random() - .5).slice(0, count);
        picks.forEach(q => currentQuestions.push({ ...q, section: sec, subsection: null, origIdx: poolIndex++, _wrongCounted: false }));
      });
      currentPage = 0;
      renderQuestions();
      toggleView('question-view');
    }

    function loadPracticeGKQuestions() {
      customFlow = false;
      currentSection = 'Practice GK';
      currentSubsection = null;
      currentQuestions = [];
      document.getElementById('wrongCount').style.display = "none";
      Object.entries(window.mcqData['General Knowledge'] || {}).forEach(([sub, arr]) => {
        const picks = (arr || []).map((q,i) => ({ ...q, section: 'General Knowledge', subsection: sub, origIdx: i, _wrongCounted: false }))
                               .sort(() => Math.random() - .5)
                               .slice(0,2);
        currentQuestions.push(...picks);
      });
      currentQuestions.sort(() => Math.random() - .5);
      currentPage = 0;
      renderQuestions();
      toggleView('question-view');
    }

    function prepareMarkedView() {
      customFlow = true;
      currentSection = 'Marked Questions';
      currentSubsection = null;
      const groups = [];
      Object.entries(window.mcqData || {}).forEach(([sec, val]) => {
        if (!Array.isArray(val)) {
          Object.entries(val).forEach(([sub, arr]) => {
            const count = (arr || []).reduce((acc, q, i) => {
              const key = `${sec}::${sub}::${i}`;
              return acc + (marked.includes(key) ? 1 : 0);
            }, 0);
            if (count > 0) groups.push({ section: sec, subsection: sub, count });
          });
        } else {
          const count = (val || []).reduce((acc, q, i) => {
            const key = `${sec}::${i}`;
            return acc + (marked.includes(key) ? 1 : 0);
          }, 0);
          if (count > 0) groups.push({ section: sec, subsection: null, count });
        }
      });

      document.getElementById('subsection-title').textContent = 'Marked Questions (grouped)';
      const list = document.getElementById('subsections-list'); list.innerHTML = '';

      if (groups.length === 0) {
        const card = document.createElement('div');
        card.className = 'section-card';
        card.textContent = 'No marked questions';
        list.appendChild(card);
      } else {
        groups.forEach(g => {
          const card = document.createElement('div');
          card.className = 'section-card';
          card.innerHTML = `<strong>${g.section}</strong>${g.subsection ? ' ‚Äî ' + g.subsection : ''}<div class="group-count">${g.count} marked</div>`;
          card.addEventListener('click', () => loadMarkedSubsectionQuestions(g.section, g.subsection));
          list.appendChild(card);
        });
      }

      toggleView('subsection-view');
    }

    function loadMarkedSubsectionQuestions(sectionName, subsectionName) {
      customFlow = true;
      currentSection = 'Marked Questions';
      currentSubsection = subsectionName ? `${sectionName}::${subsectionName}` : `${sectionName}::_nosub`;
      const collected = [];
      if (subsectionName !== null) {
        const arr = (window.mcqData[sectionName] && window.mcqData[sectionName][subsectionName]) || [];
        arr.forEach((q, i) => {
          const key = `${sectionName}::${subsectionName}::${i}`;
          if (marked.includes(key)) collected.push({ ...q, section: sectionName, subsection: subsectionName, origIdx: i, _wrongCounted: false });
        });
      } else {
        const arr = window.mcqData[sectionName] || [];
        arr.forEach((q, i) => {
          const key = `${sectionName}::${i}`;
          if (marked.includes(key)) collected.push({ ...q, section: sectionName, subsection: null, origIdx: i, _wrongCounted: false });
        });
      }
      currentQuestions = collected;
      currentPage = 0;
      renderQuestions();
      toggleView('question-view');
    }

    function prepareReportedView() {
      customFlow = true;
      currentSection = 'Reported Questions';
      currentSubsection = null;
      const groups = [];
      Object.entries(window.mcqData || {}).forEach(([sec, val]) => {
        if (!Array.isArray(val)) {
          Object.entries(val).forEach(([sub, arr]) => {
            const count = (arr || []).reduce((acc, q, i) => {
              const key = `${sec}::${sub}::${i}`;
              return acc + (reported.includes(key) ? 1 : 0);
            }, 0);
            if (count > 0) groups.push({ section: sec, subsection: sub, count });
          });
        } else {
          const count = (val || []).reduce((acc, q, i) => {
            const key = `${sec}::${i}`;
            return acc + (reported.includes(key) ? 1 : 0);
          }, 0);
          if (count > 0) groups.push({ section: sec, subsection: null, count });
        }
      });

      document.getElementById('subsection-title').textContent = 'Reported Questions (grouped)';
      const list = document.getElementById('subsections-list'); list.innerHTML = '';
      if (groups.length === 0) {
        const card = document.createElement('div');
        card.className = 'section-card';
        card.textContent = 'No reported questions';
        list.appendChild(card);
      } else {
        groups.forEach(g => {
          const card = document.createElement('div');
          card.className = 'section-card';
          card.innerHTML = `<strong>${g.section}</strong>${g.subsection ? ' ‚Äî ' + g.subsection : ''}<div class="group-count">${g.count} reported</div>`;
          card.addEventListener('click', () => loadReportedSubsectionQuestions(g.section, g.subsection));
          list.appendChild(card);
        });
      }
      toggleView('subsection-view');
    }

    function loadReportedSubsectionQuestions(sectionName, subsectionName) {
      customFlow = true;
      currentSection = 'Reported Questions';
      currentSubsection = subsectionName ? `${sectionName}::${subsectionName}` : `${sectionName}::_nosub`;
      const collected = [];
      if (subsectionName !== null) {
        const arr = (window.mcqData[sectionName] && window.mcqData[sectionName][subsectionName]) || [];
        arr.forEach((q, i) => {
          const key = `${sectionName}::${subsectionName}::${i}`;
          if (reported.includes(key)) collected.push({ ...q, section: sectionName, subsection: subsectionName, origIdx: i, _wrongCounted: false });
        });
      } else {
        const arr = window.mcqData[sectionName] || [];
        arr.forEach((q, i) => {
          const key = `${sectionName}::${i}`;
          if (reported.includes(key)) collected.push({ ...q, section: sectionName, subsection: null, origIdx: i, _wrongCounted: false });
        });
      }
      currentQuestions = collected;
      currentPage = 0;
      renderQuestions();
      toggleView('question-view');
    }

    function renderQuestions() {
      const container = document.getElementById('questionsContainer');
      container.innerHTML = '';
      const slice = currentQuestions.slice(currentPage * pageSize, (currentPage + 1) * pageSize);
      slice.forEach((q, idx) => {
        const card = document.createElement('div'); card.className = 'question';
        const title = document.createElement('h3');
        title.textContent = `${currentPage * pageSize + idx + 1}. ${q.question}`;
        card.appendChild(title);
        if (q.image) {
          const img = document.createElement('img');
          img.src = q.image;
          img.style.maxWidth = '100%';
          img.style.maxHeight = '130px';
          card.appendChild(img);
        }
        const opts = document.createElement('ul'); opts.className = 'options';
        (q.options || []).forEach((opt, i) => {
          const li = document.createElement('li'); li.textContent = opt;
          li.addEventListener('click', (ev) => {
            if (i === q.answer) {
              li.style.background = '#d4edda';
            } else {
              li.style.background = '#f8d7da';
              if (!q._wrongCounted) {
                q._wrongCounted = true;
                if (currentSection === 'Practice Questions') {
                  wrongCount++;
                  document.getElementById('wrongCount').textContent = `Wrong Answers: ${wrongCount}`;
                }
              }
            }
            // options remain clickable (no disabling)
          });
          opts.appendChild(li);
        });
        card.appendChild(opts);

        const key = (typeof q.subsection === 'string' && q.subsection !== '') ? `${q.section}::${q.subsection}::${q.origIdx}` : `${q.section}::${q.origIdx}`;

        const star = document.createElement('span');
        star.className = 'star';
        star.innerHTML = marked.includes(key) ? '‚òÖ' : '‚òÜ';
        if (marked.includes(key)) star.classList.add('marked');
        star.addEventListener('click', () => toggleMark(key, star));
        card.appendChild(star);

        const flag = document.createElement('span'); flag.className = 'report';
        flag.innerHTML = reported.includes(key) ? 'üö©' : 'üè≥Ô∏è';
        if (reported.includes(key)) flag.classList.add('reported');
        flag.addEventListener('click', () => toggleReport(key, flag));
        card.appendChild(flag);

        container.appendChild(card);
      });

      renderPagination();
      document.getElementById('questionsContainer').scrollIntoView({ block: 'start' });
    }

    function renderPagination() {
      const pag = document.getElementById('pagination'); pag.innerHTML = '';
      const total = Math.max(1, Math.ceil(currentQuestions.length / pageSize));
      if (currentPage > 0) {
        const prev = document.createElement('button');
        prev.className = 'nav-btn';
        prev.textContent = '‚Üê Previous';
        prev.addEventListener('click', () => { currentPage--; renderQuestions(); });
        pag.appendChild(prev);
      }
      const info = document.createTextNode(` Page ${currentPage + 1} of ${total} `);
      pag.appendChild(info);
      if (currentPage < total - 1) {
        const next = document.createElement('button');
        next.className = 'nav-btn';
        next.textContent = 'Next ‚Üí';
        next.addEventListener('click', () => { currentPage++; renderQuestions(); });
        pag.appendChild(next);
      }
    }

    function toggleMark(key, el) {
      if (marked.includes(key)) {
        marked = marked.filter(k => k !== key);
        el.innerHTML = '‚òÜ';
        el.classList.remove('marked');
      } else {
        marked.push(key);
        el.innerHTML = '‚òÖ';
        el.classList.add('marked');
      }
      localStorage.setItem('marked', JSON.stringify(marked));
    }

    function toggleReport(key, el) {
      if (reported.includes(key)) {
        reported = reported.filter(k => k !== key);
        el.innerHTML = 'üè≥Ô∏è';
        el.classList.remove('reported');
      } else {
        reported.push(key);
        el.innerHTML = 'üö©';
        el.classList.add('reported');
      }
      localStorage.setItem('reported', JSON.stringify(reported));
    }

    function goBack() {
      if (document.getElementById('question-view').style.display === 'block') {
        if (customFlow) {
          toggleView('subsection-view');
        } else if (currentSubsection) {
          toggleView('subsection-view');
        } else {
          toggleView('main-view');
        }
      } else {
        toggleView('main-view');
      }
    }

    // initial view
    toggleView('main-view');
  </script>
</body>
</html>
